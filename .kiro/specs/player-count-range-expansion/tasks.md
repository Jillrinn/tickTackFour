# 実装計画

### TDD実装プロセス（必須）
各タスクの実装時は以下のTDDプロセスに従うこと：
1. **RED phase**: 実装前にテストケースを作成
2. **GREEN phase**: 最小限の実装でテストをパス
3. **REFACTOR phase**: 必要に応じてリファクタリング
4. `npm test`で全テストが成功することを確認

### TDD Implementation Process (Required)
Follow this TDD process for each task implementation:
1. **RED phase**: Create test cases before implementation
2. **GREEN phase**: Minimal implementation to pass tests
3. **REFACTOR phase**: Refactor as needed
4. Run `npm test` to verify all tests pass

## Phase 1: フロントエンド定数・バリデーション変更

- [ ] 1. プレイヤー人数範囲定数を2-6人に拡張する
- [x] 1.1 プレイヤー人数の最小値定数を変更する
  - 最小プレイヤー人数を4人から2人に変更
  - バリデーションロジックで2-6人の範囲を受け入れるようにする
  - エラーメッセージが新しい範囲（2〜6人）を正しく表示するようにする
  - _Requirements: 要件1.1, 要件3.1_

- [x] 1.2 プレイヤー人数バリデーションのテストケースを更新する
  - 2人と3人のプレイヤー数が有効として扱われることを検証する
  - 1人以下のプレイヤー数が無効として扱われることを検証する
  - 7人以上のプレイヤー数が無効として扱われることを検証する
  - 全ての有効な人数（2, 3, 4, 5, 6人）でバリデーションが成功することを検証する
  - _Requirements: 要件3.1, 要件3.4_

- [x] 1.3 プレイヤー配列管理ロジックのテストケースを追加する
  - 2人設定時にプレイヤー配列が正しく2要素になることを検証する
  - 3人設定時にプレイヤー配列が正しく3要素になることを検証する
  - 4人から2人への変更時にプレイヤー3-4が削除されることを検証する
  - 2人から4人への変更時にプレイヤー3-4が追加されることを検証する
  - プレイヤー人数変更時に全プレイヤーの時間が0にリセットされることを検証する
  - _Requirements: 要件2.1, 要件2.2, 要件3.5_

## Phase 2: UI層の変更

- [ ] 2. プレイヤー人数選択UIを2-6人対応に更新する
- [x] 2.1 ドロップダウンに2人と3人の選択肢を追加する
  - プレイヤー人数ドロップダウンに2人の選択肢を追加する
  - プレイヤー人数ドロップダウンに3人の選択肢を追加する
  - デフォルト値が4人のまま維持されることを確認する
  - ゲーム開始前はドロップダウンが有効化されていることを確認する
  - _Requirements: 要件1.1, 要件1.5, 要件6.1_

- [ ] 2.2 レスポンシブレイアウトでの表示を確認する
  - スマートフォン表示（375x667px）で2-3人分のカードが正しく表示されることをブラウザで確認する
  - タブレット表示（768x1024px）で2列グリッドレイアウトが正しく機能することをブラウザで確認する
  - PC表示（1920x1080px）で横並びレイアウトが正しく機能することをブラウザで確認する
  - プレイヤーカードの全機能（プレイヤー名入力、経過時間表示、タイムアウト表示）が2-3人でも動作することを確認する
  - _Requirements: 要件2.4, 要件2.5_

## Phase 3: バックエンドAPI変更

- [ ] 3. バックエンドAPIのプレイヤー人数バリデーションを2-6人に更新する
- [ ] 3.1 プレイヤー人数バリデーションロジックを変更する
  - バリデーション条件を4-6人から2-6人に変更する
  - エラーメッセージを「2人から6人の範囲で指定してください」に更新する
  - コメント内のプレイヤー人数範囲表記を（4-6）から（2-6）に更新する
  - _Requirements: 要件3.3, 要件3.4_

- [ ] 3.2 バックエンドAPIのテストケースを追加する
  - 2人のプレイヤー数を受け入れてステータス200を返すことを検証する
  - 3人のプレイヤー数を受け入れてステータス200を返すことを検証する
  - 1人のプレイヤー数を拒否してステータス400を返すことを検証する
  - 7人のプレイヤー数を拒否してステータス400を返すことを検証する
  - エラーレスポンスに「2人から6人の範囲」というメッセージが含まれることを検証する
  - _Requirements: 要件3.3, 要件3.4_

- [ ] 3.3 プレイヤー追加・削除ロジックの動作を検証する
  - 2人から4人への増加時にプレイヤー3-4が正しく追加されることを検証する
  - 3人から6人への増加時にプレイヤー4-6が正しく追加されることを検証する
  - 6人から2人への減少時にプレイヤー3-6が正しく削除されることを検証する
  - プレイヤーIDと名前が正しく設定されることを検証する
  - _Requirements: 要件2.1, 要件2.2, 要件3.3_

## Phase 4: E2Eテスト

- [ ] 4. 2-6人対応のE2Eテストを作成・実行する
- [ ] 4.1 プレイヤー人数選択の基本動作テストを作成する
  - ドロップダウンに2, 3, 4, 5, 6人の選択肢が表示されることを検証する
  - デフォルト値が4人であることを検証する
  - 2人選択時に2枚のプレイヤーカードが表示されることを検証する
  - 3人選択時に3枚のプレイヤーカードが表示されることを検証する
  - _Requirements: 要件1.1, 要件1.2, 要件1.3, 要件1.5, 要件2.1, 要件2.2_

- [ ] 4.2 プレイヤー名保持とUI更新テストを作成する
  - 4人でプレイヤー名を設定後、2人に変更したときにプレイヤー1-2の名前が保持されることを検証する
  - プレイヤー3-4のカードが非表示になることを検証する
  - 2人から4人に増加したときにプレイヤー3-4のカードが表示されることを検証する
  - _Requirements: 要件2.3, 要件5.3, 要件5.4_

- [ ] 4.3 ゲーム開始前後の制約テストを作成する
  - ゲーム開始前にプレイヤー人数ドロップダウンが有効化されていることを検証する
  - ゲーム開始後にドロップダウンが無効化されることを検証する
  - ゲームリセット後にドロップダウンが再度有効化されることを検証する
  - _Requirements: 要件6.1, 要件6.2, 要件6.3_

- [ ] 4.4 2-3人モードでの全タイマー機能動作テストを作成する
  - 2人モードでゲーム開始、ターン切り替え、一時停止、再開、リセットが正常に動作することを検証する
  - 3人モードでゲーム開始、ターン切り替え、一時停止、再開、リセットが正常に動作することを検証する
  - アクティブプレイヤー表示が正しく切り替わることを検証する
  - ターン時間表示が正しく更新されることを検証する
  - _Requirements: 要件4.1_

- [ ] 4.5 カウントアップ/ダウンモード互換性テストを作成する
  - 2人モードでカウントアップモードが正常に動作することを検証する
  - 2人モードでカウントダウンモードとタイムアウト検知が正常に動作することを検証する
  - 3人モードでカウントアップモードが正常に動作することを検証する
  - 3人モードでカウントダウンモードとタイムアウト検知が正常に動作することを検証する
  - _Requirements: 要件4.2, 要件4.3_

- [ ] 4.6 拡張機能互換性テストを作成する
  - 2-3人モードで最長時間プレイヤー表示が正常に動作することを検証する
  - 2-3人モードでゲーム全体時間表示が正常に動作することを検証する
  - 2-3人モードでポーリング同期（5秒間隔）が正常に動作することを検証する
  - 2-3人モードでプレイヤー名永続化が正常に動作することを検証する
  - _Requirements: 要件4.4, 要件4.5, 要件5.1, 要件5.2_

## Phase 5: 統合テストと最終検証

- [ ] 5. 全機能の統合動作を検証する
- [ ] 5.1 フォールバックモードでの2-6人動作を検証する
  - API接続失敗状態で2人モードが正常に動作することをブラウザで確認する
  - API接続失敗状態で3人モードが正常に動作することをブラウザで確認する
  - インメモリー状態管理でプレイヤー配列が正しく管理されることを確認する
  - _Requirements: 要件3.1_

- [ ] 5.2 通常モード（APIモード）での2-6人動作を検証する
  - API接続成功状態で2人モードが正常に動作することをブラウザで確認する
  - API接続成功状態で3人モードが正常に動作することをブラウザで確認する
  - Chrome DevToolsでAPIリクエスト/レスポンスを確認する（POST /api/updateGame { playerCount: 2 } → 200 OK）
  - ポーリング同期でプレイヤー配列が正しく更新されることを確認する
  - _Requirements: 要件3.2, 要件3.3_

- [ ] 5.3 全受入基準の最終検証を実施する
  - 要件1の全受入基準（1.1〜1.5）が満たされていることを確認する
  - 要件2の全受入基準（2.1〜2.5）が満たされていることを確認する
  - 要件3の全受入基準（3.1〜3.5）が満たされていることを確認する
  - 要件4の全受入基準（4.1〜4.5）が満たされていることを確認する
  - 要件5の全受入基準（5.1〜5.4）が満たされていることを確認する
  - 要件6の全受入基準（6.1〜6.3）が満たされていることを確認する
  - _Requirements: 全要件_

- [ ] 5.4 実装完了処理を実施する
  - 全テスト結果の確認（ユニットテスト、E2Eテスト全てパス）
  - spec.jsonのphaseを"implementation-done"に更新
  - tasks.mdの全タスクをチェック済み[x]に更新
  - 詳細なコミットメッセージを作成（実装内容、テスト結果含む）
  - Gitコミット作成（実装完了の最終コミット）
  - _Requirements: 実装完了プロセス_

# 実装タスク

## Phase 1: Page Object Model更新

- [ ] 1. GameTimerPageのAdapterパターン実装
- [ ] 1.1 setPlayerActive()メソッドをAdapterパターンに更新
  - 現在のアクティブプレイヤーインデックスを取得する機能
  - 目標プレイヤーまでの切り替え回数を計算する機能
  - switchToNextPlayer()を繰り返し呼び出して順次切り替える機能
  - UI更新待機のための適切なタイムアウト設定
  - _Requirements: 1.1_

- [ ] 1.2 新UI要素操作メソッドの追加
  - changePlayerCount()メソッドを追加してドロップダウンでプレイヤー数を変更する機能
  - changeTimerMode()メソッドを追加してトグルスイッチでタイマーモードを変更する機能
  - 固定ヘッダー内のUI要素ロケーターを追加
  - _Requirements: 1.2, 1.3_

- [ ] 1.3 既存タイマーモードメソッドのトグルスイッチ対応
  - setTimerModeCountUp()をトグルスイッチ操作に対応
  - setTimerModeCountDown()をトグルスイッチ操作に対応
  - カウントダウン秒数設定機能を維持
  - _Requirements: 1.3_

- [ ] 1.4 switchToNextPlayer()メソッドの固定ヘッダー対応確認
  - 固定ヘッダー内の「次のプレイヤーへ→」ボタンを正しくクリックする機能
  - TypeScript型チェック実行で型エラーがないことを確認
  - _Requirements: 1.4_

## Phase 2: テストスイート修正

- [ ] 2. アクティブプレイヤー操作テストの修正
- [ ] 2.1 active-player.spec.tsのテスト修正
  - setPlayerActive()使用箇所は変更不要（Page Objectで吸収）
  - 固定ヘッダーの「次のプレイヤーへ→」ボタン使用を検証
  - アクティブプレイヤーの時間計測テストを検証
  - 非アクティブプレイヤーの時間停止テストを検証
  - _Requirements: 2.1, 2.2, 2.3, 2.4_

- [ ] 2.2 active-player.spec.tsのテスト実行と検証
  - 全7件のテストを実行して成功を確認
  - 失敗テストがある場合は原因を分析して追加修正
  - _Requirements: 2.5_

- [ ] 3. ゲームコントロールテストの修正
- [ ] 3.1 game-controls.spec.tsのテスト修正
  - switchToNextPlayer()メソッド使用を維持
  - 一時停止・再開テストで時間停止と再開を検証
  - リセットテストで全プレイヤーの時間と状態初期化を検証
  - _Requirements: 3.1, 3.2, 3.3_

- [ ] 3.2 game-controls.spec.tsのテスト実行と検証
  - 全6件のテストを実行して成功を確認
  - 失敗テストがある場合は原因を分析して追加修正
  - _Requirements: 3.4_

- [ ] 4. プレイヤー数管理テストの修正
- [ ] 4.1 player-management.spec.tsのテスト修正
  - changePlayerCount()メソッドでドロップダウン操作に置き換え
  - プレイヤー数を4人から5人に変更するテストを修正
  - プレイヤー数を5人から6人に変更するテストを修正
  - プレイヤー数を6人から4人に変更するテストを修正
  - _Requirements: 4.1, 4.2, 4.3, 4.4_

- [ ] 4.2 プレイヤー名編集テストのスキップ対応
  - プレイヤー名編集テスト7件にtest.skip()を追加
  - TODO コメントで通常モード対応が必要な理由を明記
  - フォールバックモード専用テストとして分離
  - _Requirements: 6.1, 6.2, 6.3_

- [ ] 4.3 player-management.spec.tsのテスト実行と検証
  - 全8件のテストを実行（1件成功、7件スキップ）
  - 失敗テストがある場合は原因を分析して追加修正
  - _Requirements: 4.5_

- [ ] 5. タイマーモード変更テストの修正
- [ ] 5.1 timer-operations.spec.tsのテスト修正
  - changeTimerMode()メソッドでトグルスイッチ操作に置き換え
  - カウントアップからカウントダウンに変更するテストを修正
  - カウントダウンからカウントアップに変更するテストを修正
  - タイマーモード変更時の時間リセットテストを修正
  - _Requirements: 5.1, 5.2, 5.3_

- [ ] 5.2 timer-operations.spec.tsのテスト実行と検証
  - 全6件のテストを実行して成功を確認
  - 失敗テストがある場合は原因を分析して追加修正
  - _Requirements: 5.4_

- [ ] 6. ターン時間トラッキングテストの修正
- [ ] 6.1 turn-time-tracking.spec.tsのタイミング戦略見直し
  - ボタンクリック後にwaitForTimeout()で適切な待機時間を設定
  - expect.poll()でポーリング待機を追加して状態が更新されるまで待機
  - ターン切り替え後の時間検証テストにポーリング戦略を適用
  - ターン時間リセットテストにポーリング戦略を適用
  - _Requirements: 7.1, 7.2, 7.3_

- [ ] 6.2 turn-time-tracking.spec.tsのテスト実行と検証
  - 全10件のテストを実行して成功を確認
  - 失敗テストがある場合はタイムアウト設定を調整して追加修正
  - _Requirements: 7.4_

- [ ] 7. UIコントロール強化テストの修正
- [ ] 7.1 ui-controls-enhancement.spec.tsのテスト修正
  - 更新されたPage Objectメソッドを使用
  - changePlayerCount()メソッドでドロップダウン操作テストを修正
  - changeTimerMode()メソッドでトグルスイッチ操作テストを修正
  - 固定ヘッダー内のボタンとUI要素操作テストを修正
  - _Requirements: 8.1, 8.2, 8.3, 8.4_

- [ ] 7.2 ui-controls-enhancement.spec.tsのテスト実行と検証
  - 全11件のテストを実行して成功を確認
  - 失敗テストがある場合は原因を分析して追加修正
  - _Requirements: 8.5_

- [ ] 8. レスポンシブUIテストの修正
- [ ] 8.1 responsive-ui.spec.tsのテスト修正
  - 新しいUI構造（固定ヘッダー、セクション分割）に対応した要素検証を実施
  - モバイルビューポートテストで固定ヘッダーと主要操作セクション表示を検証
  - 新UI要素ロケーターを使用してレスポンシブレイアウトを検証
  - _Requirements: 9.1, 9.2_

- [ ] 8.2 responsive-ui.spec.tsのテスト実行と検証
  - 全2件のテストを実行して成功を確認
  - 失敗テストがある場合は原因を分析して追加修正
  - _Requirements: 9.3_

## Phase 3: E2Eテスト実行と結果検証

- [ ] 9. 全E2Eテストスイートの実行と結果検証
- [ ] 9.1 全E2Eテストスイートを実行
  - npx playwright testコマンドで全テストを実行
  - 50件の失敗テストが全て成功することを確認（57件 - 7件スキップ = 50件）
  - 既存の18件の成功テストが引き続き成功することを確認
  - Phase 2専用テスト11件とプレイヤー名編集テスト7件が引き続きスキップされることを確認
  - _Requirements: 10.1, 10.2, 10.3_

- [ ] 9.2 テスト結果レポートの確認と分析
  - Playwright HTML Reportで全テスト結果を可視化
  - 成功テスト数68件（50修正成功 + 18既存成功）を確認
  - スキップテスト数18件（11 Phase 2専用 + 7プレイヤー名編集）を確認
  - 失敗テスト数0件を確認
  - _Requirements: 10.4, 10.5, 10.6_

- [ ] 9.3 失敗テストの原因分析と追加修正（必要な場合）
  - 失敗テストが10件以上の場合は全修正をロールバックして根本原因を再調査
  - 失敗テストが10件未満の場合はスクリーンショットとビデオで原因を特定
  - 追加修正を実施して再度全テストを実行
  - _Requirements: All requirements_

- [ ] 9.4 Gitコミット作成とspec.json更新
  - tasks.mdの全タスクを完了[x]にマーク
  - spec.jsonのphaseを"implementation-done"に更新
  - 詳細なコミットメッセージを作成（テスト成功数とスキップ数を含む）
  - Gitコミットを作成して実装完了を記録
  - _Requirements: 10.7_

# Requirements Document

## はじめに

プレイヤー名初期値標準化機能は、ゲームタイマーシステムにおけるプレイヤー名の初期値に関する一貫性を確保し、データベース保存ロジックを改善する機能です。この機能により、すべてのプレイヤーの初期値が日本語の「プレイヤー」に統一され、初期値として設定された名前がデータベースに不要に保存されることを防ぎます。

現在のシステムでは、プレイヤー名の初期値生成ロジックは`プレイヤー${index + 1}`（例：「プレイヤー1」、「プレイヤー2」）を使用していますが、デフォルト名のフィルタリングパターンとコードベース全体で一貫性を保つため、英語の"player"が使用されている箇所がないか確認し、すべて日本語の「プレイヤー」に統一する必要があります。また、プレイヤー名永続化機能（player-name-persistence）において、初期値がデータベースに保存されないように、フィルタリングロジックを検証・強化します。

## 要件

### 要件1: プレイヤー名初期値の統一

**目的:** 開発者として、プレイヤー名の初期値をすべて日本語の「プレイヤー」に統一することで、コードベース全体で一貫性を保ち、メンテナンスを容易にしたい

#### 受け入れ基準

1. WHEN ゲームが初期化される THEN ゲームタイマーシステム SHALL 各プレイヤーに「プレイヤー1」、「プレイヤー2」、「プレイヤー3」、「プレイヤー4」、「プレイヤー5」、「プレイヤー6」の形式で初期値を設定する

2. WHEN プレイヤー人数が変更される AND 新しいプレイヤーが追加される THEN ゲームタイマーシステム SHALL 追加されたプレイヤーに「プレイヤー${index + 1}」の形式で初期値を設定する

3. WHERE コードベース全体 THE ゲームタイマーシステム SHALL 英語の"player1"、"player2"などの英語形式のデフォルト名を使用しない

4. WHERE フロントエンドコード THE ゲームタイマーシステム SHALL 日本語の「プレイヤー」のみをデフォルト名として使用する

5. WHERE バックエンドコード（API、データモデル等） THE ゲームタイマーシステム SHALL 英語の"player"形式のデフォルト名を使用しない

### 要件2: デフォルト名フィルタリングパターンの検証と強化

**目的:** 開発者として、デフォルト名を正確に識別するフィルタリングパターンを維持することで、初期値がデータベースに保存されないことを保証したい

#### 受け入れ基準

1. WHERE フロントエンド THE ゲームタイマーシステム SHALL デフォルト名パターン`/^プレイヤー([1-9]|10)$/`を使用してデフォルト名を識別する

2. WHEN プレイヤー名が「プレイヤー1」から「プレイヤー6」のいずれかである THEN ゲームタイマーシステム SHALL その名前をデフォルト名として識別する

3. WHEN プレイヤー名が「プレイヤー7」から「プレイヤー10」のいずれかである THEN ゲームタイマーシステム SHALL その名前をデフォルト名として識別する

4. WHEN プレイヤー名が「プレイヤー」で始まるが数字が11以上である OR 数字が0である OR 数字がない THEN ゲームタイマーシステム SHALL その名前をデフォルト名として識別しない

5. WHEN プレイヤー名が「プレイヤー」で始まるが前後に空白や特殊文字が含まれる THEN ゲームタイマーシステム SHALL その名前をデフォルト名として識別しない

### 要件3: データベース保存ロジックの検証

**目的:** システム管理者として、初期値としてのデフォルト名がデータベースに保存されないことを確実にすることで、データベースに有意義な履歴データのみが蓄積されるようにしたい

#### 受け入れ基準

1. WHEN ユーザーがプレイヤー名を変更せずにゲームを開始する THEN フロントエンド SHALL デフォルト名（「プレイヤー1」等）をバックエンドAPIに送信しない

2. WHEN ユーザーがプレイヤー名を変更せずにゲームをリセットする OR ブラウザを閉じる THEN フロントエンド SHALL デフォルト名をバックエンドAPIに送信しない

3. WHEN プレイヤー名保存関数（`saveNames`）が呼び出される AND すべての名前がデフォルト名である THEN フロントエンド SHALL API呼び出しをスキップする

4. WHEN プレイヤー名保存関数が呼び出される AND 一部の名前がデフォルト名である THEN フロントエンド SHALL デフォルト名を除外し、変更された名前のみをバックエンドAPIに送信する

5. WHEN バックエンドAPIが空の名前配列を受信する THEN バックエンドAPI SHALL データベースへの書き込みを実行せず、成功レスポンスを返す

### 要件4: コードベース全体の一貫性確認

**目的:** 開発者として、コードベース全体でプレイヤー名の初期値に関する一貫性を確保することで、将来的なバグや混乱を防ぎたい

#### 受け入れ基準

1. WHERE テストコード THE ゲームタイマーシステム SHALL デフォルト名として「プレイヤー1」等の日本語形式を期待値として使用する

2. WHERE ドキュメントとコメント THE ゲームタイマーシステム SHALL デフォルト名の例として「プレイヤー1」等の日本語形式を使用する

3. WHEN コードレビューが実施される THEN 開発者 SHALL 英語の"player"形式のデフォルト名が新たに導入されていないことを確認する

4. WHERE 型定義とインターフェース THE ゲームタイマーシステム SHALL プレイヤー名のデフォルト値を文字列型として定義し、具体的なデフォルト値は実装層で管理する

### 要件5: フィルタリングロジックの単体テスト強化

**目的:** 開発者として、デフォルト名フィルタリングロジックが正確に機能することを保証するため、包括的な単体テストを実装したい

#### 受け入れ基準

1. WHEN デフォルト名フィルタリング関数（`filterDefaultNames`）が「プレイヤー1」を入力として受け取る THEN 関数 SHALL 空の配列を返す

2. WHEN デフォルト名フィルタリング関数が「プレイヤー6」を入力として受け取る THEN 関数 SHALL 空の配列を返す

3. WHEN デフォルト名フィルタリング関数が「プレイヤー10」を入力として受け取る THEN 関数 SHALL 空の配列を返す

4. WHEN デフォルト名フィルタリング関数が「プレイヤー11」を入力として受け取る THEN 関数 SHALL その名前を含む配列を返す（デフォルト名ではないため）

5. WHEN デフォルト名フィルタリング関数が「アリス」、「プレイヤー1」、「ボブ」の配列を入力として受け取る THEN 関数 SHALL「アリス」、「ボブ」のみを含む配列を返す

6. WHEN デフォルト名フィルタリング関数が「 プレイヤー1 」（前後に空白）を入力として受け取る THEN 関数 SHALL その名前を含む配列を返す（完全一致しないため）

7. WHEN デフォルト名フィルタリング関数が「プレイヤー01」を入力として受け取る THEN 関数 SHALL その名前を含む配列を返す（先頭ゼロは許可しないため）

### 要件6: 後方互換性と既存機能への影響排除

**目的:** システム管理者として、既存のゲームタイマー機能とプレイヤー名永続化機能に一切影響を与えないことを保証したい

#### 受け入れ基準

1. WHEN プレイヤー名初期値標準化機能が適用される THEN ゲームタイマーシステム SHALL 既存のタイマー機能、ターン管理、ゲームコントロールに一切影響を与えない

2. WHEN プレイヤー名初期値標準化機能が適用される THEN プレイヤー名永続化機能 SHALL 変更された名前の保存・取得機能を正常に動作させる

3. WHEN 既存のE2Eテストが実行される THEN すべてのテスト SHALL パスし、リグレッションが発生しない

4. WHEN 既存のユニットテストが実行される THEN すべてのテスト SHALL パスし、既存機能に破壊的変更がないことを確認する

### 要件7: ドキュメントとコメントの更新

**目的:** 開発者として、コードベース内のドキュメントとコメントが最新の実装を正確に反映することで、メンテナンス性を向上させたい

#### 受け入れ基準

1. WHERE 関数とコンポーネントのドキュメントコメント THE 開発者 SHALL デフォルト名の例として「プレイヤー1」等の日本語形式を使用する

2. WHERE 仕様ドキュメント（requirements.md、design.md等） THE 開発者 SHALL デフォルト名の形式を明確に記述する

3. WHERE 既存の仕様ドキュメント（player-name-persistence） THE 開発者 SHALL デフォルト名の例として「プレイヤー1」の使用を確認し、必要に応じて更新する

4. WHERE README.mdやユーザー向けドキュメント THE 開発者 SHALL プレイヤー名の初期値として「プレイヤー1」等の日本語形式を例示する

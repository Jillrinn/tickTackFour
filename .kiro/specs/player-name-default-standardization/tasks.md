# 実装計画

### TDD実装プロセス（必須）
各タスクの実装時は以下のTDDプロセスに従うこと：
1. **RED phase**: 実装前にテストケースを作成
2. **GREEN phase**: 最小限の実装でテストをパス
3. **REFACTOR phase**: 必要に応じてリファクタリング
4. `npm test`で全テストが成功することを確認

## Phase 0: バックエンドのバグ修正

- [x] 1. バックエンドAPIのプレイヤー名初期値を日本語形式に修正
- [x] 1.1 プレイヤー数増加時のデフォルト名生成ロジックを修正
  - プレイヤー数増加処理で英語の"Player N"が生成される問題を修正
  - 日本語の「プレイヤーN」形式に統一
  - 修正後、全てのプレイヤー名が「プレイヤー1」～「プレイヤー6」形式になることを確認
  - _Requirements: 1.2, 1.5_

- [ ] 1.2 プレイヤー数増加時のデフォルト名検証テストを作成
  - プレイヤー数を4人から5人に増加した場合、5人目の名前が「プレイヤー5」であることを確認するテスト
  - プレイヤー数を4人から6人に増加した場合、5-6人目の名前が「プレイヤー5」「プレイヤー6」であることを確認するテスト
  - バックエンド単体テストで全テストがパスすることを確認
  - _Requirements: 1.2, 4.1_

- [ ] 1.3 既存バックエンドテストの実行とリグレッション確認
  - 修正後に全ての既存バックエンドテストを実行
  - リグレッションが発生していないことを確認
  - テスト失敗がある場合は原因を特定して修正
  - _Requirements: 6.4_

## Phase 1: フロントエンド単体テスト追加

- [ ] 2. デフォルト名フィルタリングロジックの単体テストを実装
- [ ] 2.1 filterDefaultNames関数の基本フィルタリングテストを作成
  - 「プレイヤー1」をフィルタリングして空配列を返すテスト
  - 「プレイヤー6」をフィルタリングして空配列を返すテスト
  - 「プレイヤー10」をフィルタリングして空配列を返すテスト
  - _Requirements: 2.2, 2.3, 5.1, 5.2, 5.3_

- [ ] 2.2 filterDefaultNames関数のエッジケーステストを作成
  - 「プレイヤー11」はフィルタリングしない（デフォルト名ではない）テスト
  - 「 プレイヤー1 」（前後に空白）はフィルタリングしないテスト
  - 「プレイヤー01」（先頭ゼロ）はフィルタリングしないテスト
  - _Requirements: 2.4, 2.5, 5.4, 5.6, 5.7_

- [ ] 2.3 filterDefaultNames関数の混在ケーステストを作成
  - 「アリス」、「プレイヤー1」、「ボブ」の配列から「アリス」、「ボブ」のみを返すテスト
  - デフォルト名と変更された名前が混在する場合の正しいフィルタリングを確認
  - _Requirements: 2.2, 5.5_

- [ ] 3. プレイヤー名デフォルト値生成ロジックの単体テストを実装
- [ ] 3.1 createDefaultPlayer関数の基本テストを作成
  - デフォルト名が日本語形式「プレイヤー1」であることを確認するテスト
  - インデックスが正しく反映されることを確認するテスト（「プレイヤー1」、「プレイヤー5」等）
  - _Requirements: 1.1, 1.4, 4.1_

- [ ] 3.2 フロントエンド単体テストの実行と検証
  - 新規テストを含む全てのフロントエンド単体テストを実行
  - `npm test`で全テストがパスすることを確認
  - テストカバレッジが目標値（100%）に達していることを確認
  - _Requirements: 6.4_

## Phase 2: ドキュメント整備

- [ ] 4. 関数ドキュメントコメントを追加
- [ ] 4.1 createDefaultPlayer関数にJSDocコメントを追加
  - デフォルトプレイヤーオブジェクトを生成する関数のドキュメント
  - パラメータ、戻り値、使用例を記述
  - デフォルト名の例として「プレイヤー1」を使用
  - _Requirements: 7.1, 7.2_

- [ ] 4.2 DEFAULT_PLAYER_NAME_PATTERN定数にJSDocコメントを追加
  - デフォルトプレイヤー名を識別する正規表現パターンのドキュメント
  - マッチ対象（「プレイヤー1」～「プレイヤー10」）を明記
  - マッチしない例（「プレイヤー11」、「プレイヤー01」、「 プレイヤー1 」）を明記
  - _Requirements: 2.1, 7.1, 7.2_

- [ ] 4.3 filterDefaultNames関数にJSDocコメントを追加
  - デフォルト名を配列から除外する関数のドキュメント
  - パラメータ、戻り値を記述
  - 仕様ドキュメント（requirements.md）への参照を追加
  - _Requirements: 7.1, 7.2_

## Phase 3: 統合テスト追加

- [ ] 5. プレイヤー名保存処理の統合テストを実装
- [ ] 5.1 全てデフォルト名の場合のAPI呼び出しスキップテストを作成
  - 全てのプレイヤー名がデフォルト名の場合、API呼び出しがスキップされることを確認
  - fetchモックが呼び出されていないことを検証
  - _Requirements: 3.1, 3.2, 3.3_

- [ ] 5.2 一部デフォルト名の場合のフィルタリングテストを作成
  - 一部の名前がデフォルト名の場合、変更された名前のみがAPIに送信されることを確認
  - fetchモックが正しいリクエストボディで呼び出されることを検証
  - _Requirements: 3.4_

- [ ] 5.3 統合テストの実行と検証
  - 新規統合テストを含む全てのフロントエンドテストを実行
  - `npm test`で全テストがパスすることを確認
  - _Requirements: 6.4_

## Phase 4: E2Eテスト拡張

- [ ] 6. プレイヤー数変更時のデフォルト名検証E2Eテストを実装
- [ ] 6.1 プレイヤー数を5人に増加した場合のE2Eテストを作成
  - プレイヤー数を4人から5人に増加
  - 5人目のプレイヤー名が「プレイヤー5」であることを確認
  - UIで表示されているプレイヤー名が正しいことを検証
  - _Requirements: 1.2, 1.4_

- [ ] 6.2 プレイヤー数を6人に増加した場合のE2Eテストを作成
  - プレイヤー数を4人から6人に増加
  - 5人目と6人目のプレイヤー名が「プレイヤー5」「プレイヤー6」であることを確認
  - UIで表示されているプレイヤー名が正しいことを検証
  - _Requirements: 1.2, 1.4_

- [ ] 6.3 デフォルト名のままゲーム開始した場合のE2Eテストを作成
  - デフォルト名のままゲームを開始
  - プレイヤー名がデータベースに保存されないことを確認
  - API呼び出しログやネットワークログで検証
  - _Requirements: 3.1, 3.2_

- [ ] 6.4 一部名前変更した場合のデータベース保存E2Eテストを作成
  - 一部のプレイヤー名を変更（例：「アリス」、「ボブ」）
  - 変更された名前のみがデータベースに保存されることを確認
  - デフォルト名は除外されていることを検証
  - _Requirements: 3.4_

- [ ] 6.5 全E2Eテストの実行と検証
  - 新規E2Eテストを含む全てのE2Eテストを実行
  - `npx playwright test`で全テストがパスすることを確認
  - 既存機能にリグレッションが発生していないことを確認
  - _Requirements: 6.3_

## Phase 5: 実装完了処理

- [ ] 7. 最終検証と実装完了処理を実施
- [ ] 7.1 全テスト結果の確認
  - 全てのバックエンド単体テストが成功していることを確認
  - 全てのフロントエンド単体テストが成功していることを確認
  - 全てのE2Eテストが成功していることを確認
  - エラーや予期しない動作が発生しないことを確認
  - _Requirements: 6.1, 6.2, 6.3, 6.4_

- [ ] 7.2 spec.json更新とコミット作成
  - spec.jsonのphaseを"implementation-done"に更新
  - tasks.mdの全タスクをチェック済み[x]に更新
  - 詳細なコミットメッセージを作成（実装内容、テスト結果含む）
  - Gitコミット作成（実装完了の最終コミット）
  - _Requirements: All requirements completed_
